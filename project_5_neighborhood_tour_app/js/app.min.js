function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.75874,lng:-73.978674},map:map,zoom:11})}function mapsError(){alert("We're sorry but the Google Map failed to load")}var map,markers=ko.observableArray(),locations=[{title:"Statue of Liberty",location:{lat:40.689249,lng:-74.0445},pictures:[]},{title:"Grand Central Terminal",location:{lat:40.752726,lng:-73.977229},pictures:[]},{title:"Rockefeller Center",location:{lat:40.75874,lng:-73.978674},pictures:[]},{title:"Times Square",location:{lat:40.759011,lng:-73.984472},pictures:[]},{title:"Madison Square Garden",location:{lat:40.750506,lng:-73.993394},pictures:[]},{title:"Empire State Building",location:{lat:40.748441,lng:-73.985664},pictures:[]},{title:"Metropolitan Museum of Art",location:{lat:40.779187,lng:-73.963535},pictures:[]},{title:"Bryant Park",location:{lat:40.753597,lng:-73.983233},pictures:[]},{title:"World Trade Center site",location:{lat:40.711801,lng:-74.01312},pictures:[]},{title:"Frick Collection",location:{lat:40.771181,lng:-73.96735},pictures:[]},{title:"Yankee Stadium",location:{lat:40.828819,lng:-73.926569},pictures:[]}],ViewModel=function(){var a=this;this.siteList=ko.observableArray(),this.sitePics=ko.observableArray(),this.siteInfo=ko.observableArray(),this.initListView=function(){locations.forEach(function(b){a.siteList.push(b)}),a.getSitePhotos(),a.getSiteExtract()},this.getSitePhotos=function(){var a,b,c,d;locations.forEach(function(e){c=e.title.replace(/\s/g,""),a="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=8464c6c6332cf769ce0a9f0d5b55fd91&sort=interestingness-asc&tags="+c+"&per_page=10&page=1&format=json&nojsoncallback=1",$.ajax({type:"GET",data:d,url:a,success:function(a){d=a.photos.photo,d.forEach(function(a){b="https://farm"+a.farm+".static.flickr.com/"+a.server+"/"+a.id+"_"+a.secret+".jpg",e.pictures.push(b)})},error:function(){alert("We're sorry but the Flickr API failed to download photos of "+e.title+" in New York City")}})})},this.getSiteExtract=function(){var b,c,d;locations.forEach(function(e){c=e.title.replace(/\s/g,"+"),b="https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&titles="+c+"&exsentences=2&explaintext=1",$.ajax({type:"GET",data:d,url:b,contentType:"text/plain",withCredentials:!1,crossDomain:!0,dataType:"jsonp",timeout:2e3,success:function(b){d=b.query.pages[Object.keys(b.query.pages)[0]].extract,a.newInfoWindow(d),a.newMarker(e.location,e.title,e)},error:function(){alert("We're sorry but the WIKIPEDIA API failed to download extract of "+e.title+" in New York City")}})})},this.restoreList=function(){locations.forEach(function(b){a.siteList.push(b)})},this.restoreMarker=function(a){markers()[a].setMap(map)},this.removeMarker=function(a){markers()[a].setMap(null)},this.toggleAnimation=function(a){a.setAnimation(null!==a.getAnimation()?null:google.maps.Animation.BOUNCE)},this.setCurrentMarker=function(b){var c;if(a.siteList().length>1){a.siteList.removeAll(),a.siteList.push(b);for(c in markers())markers()[c].title!=b.title?a.removeMarker(c):(a.toggleAnimation(markers()[c]),a.siteInfo()[c].open(map,markers()[c]));b.pictures.forEach(function(b){a.sitePics.push(b)})}else{for(c in markers())markers()[c].title!=b.title?a.restoreMarker(c):(a.toggleAnimation(markers()[c]),a.siteInfo()[c].close(map,markers()[c]));a.siteList.removeAll(),a.restoreList(),a.sitePics.removeAll()}},this.query=ko.observable(""),this.search=function(b){a.siteList.removeAll();for(var c in locations)locations[c].title.toLowerCase().indexOf(b.toLowerCase())>=0?(a.siteList.push(locations[c]),markers()[c].setMap(map)):a.removeMarker(c)},this.query.subscribe(this.search),this.newInfoWindow=function(b){var c=new google.maps.InfoWindow({content:b});a.siteInfo.push(c)},this.newMarker=function(b,c,d){var e=new google.maps.Marker({position:b,animation:google.maps.Animation.DROP,map:map,title:c});e.addListener("click",function(){a.setCurrentMarker(d)}),markers.push(e)},a.initListView()};ko.applyBindings(new ViewModel);